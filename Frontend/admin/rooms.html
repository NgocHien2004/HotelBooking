<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quản lý phòng - Hotel Booking Admin</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <link href="../assets/css/style.css" rel="stylesheet" />
    <link href="../assets/css/admin.css" rel="stylesheet" />
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <nav class="navbar">
        <div class="nav-container">
          <div class="nav-logo">
            <a href="../index.html">
              <i class="fas fa-hotel"></i>
              <span>Hotel Booking Admin</span>
            </a>
          </div>

          <div class="nav-menu" id="nav-menu">
            <div class="nav-user" id="nav-user">
              <div class="user-dropdown">
                <button class="user-btn" id="user-btn">
                  <i class="fas fa-user"></i>
                  <span id="user-name">Admin</span>
                  <i class="fas fa-chevron-down"></i>
                </button>
                <div class="dropdown-menu" id="dropdown-menu">
                  <a href="../profile.html" class="dropdown-item"> <i class="fas fa-user"></i> Thông tin cá nhân </a>
                  <a href="../index.html" class="dropdown-item"> <i class="fas fa-home"></i> Trang chủ </a>
                  <hr />
                  <button class="dropdown-item logout-btn" id="logout-btn"><i class="fas fa-sign-out-alt"></i> Đăng xuất</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <!-- Admin Layout -->
    <div class="admin-layout">
      <!-- Sidebar -->
      <aside class="admin-sidebar">
        <ul class="sidebar-menu">
          <li class="sidebar-item">
            <a href="dashboard.html" class="sidebar-link">
              <i class="fas fa-tachometer-alt"></i>
              <span>Dashboard</span>
            </a>
          </li>
          <li class="sidebar-item">
            <a href="hotels.html" class="sidebar-link">
              <i class="fas fa-hotel"></i>
              <span>Quản lý khách sạn</span>
            </a>
          </li>
          <li class="sidebar-item">
            <a href="rooms.html" class="sidebar-link active">
              <i class="fas fa-bed"></i>
              <span>Quản lý phòng</span>
            </a>
          </li>
          <li class="sidebar-item">
            <a href="bookings.html" class="sidebar-link">
              <i class="fas fa-calendar-check"></i>
              <span>Quản lý đặt phòng</span>
            </a>
          </li>
          <li class="sidebar-item">
            <a href="users.html" class="sidebar-link">
              <i class="fas fa-users"></i>
              <span>Quản lý người dùng</span>
            </a>
          </li>
          <li class="sidebar-item">
            <a href="reviews.html" class="sidebar-link">
              <i class="fas fa-star"></i>
              <span>Quản lý đánh giá</span>
            </a>
          </li>
        </ul>
      </aside>

      <!-- Main Content -->
      <main class="admin-content">
        <div class="admin-header">
          <h1>Quản lý phòng</h1>
          <p>Quản lý loại phòng và phòng cụ thể</p>
        </div>

        <!-- Filter Section -->
        <div class="admin-cards">
          <div class="admin-card">
            <div class="form-group">
              <label for="hotel-filter">Lọc theo khách sạn:</label>
              <select id="hotel-filter" class="form-input">
                <option value="">Tất cả khách sạn</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Room Types Section -->
        <div class="admin-table-container">
          <div class="admin-table-header">
            <h3 class="admin-table-title">Loại phòng</h3>
            <div class="admin-table-actions">
              <input type="text" class="search-input" id="search-room-types" placeholder="Tìm kiếm loại phòng..." />
              <button class="btn btn-primary" onclick="AdminRooms.showAddRoomTypeModal()">
                <i class="fas fa-plus"></i>
                Thêm loại phòng
              </button>
            </div>
          </div>

          <div class="loading" id="room-types-loading">
            <div class="spinner"></div>
            <p>Đang tải dữ liệu...</p>
          </div>

          <table class="admin-table" id="room-types-table" style="display: none">
            <thead>
              <tr>
                <th>ID</th>
                <th>Tên loại phòng</th>
                <th>Khách sạn</th>
                <th>Giá/đêm</th>
                <th>Sức chứa</th>
                <th>Số phòng</th>
                <th>Thao tác</th>
              </tr>
            </thead>
            <tbody id="room-types-table-body">
              <!-- Room types will be loaded here -->
            </tbody>
          </table>
        </div>

        <!-- Individual Rooms Section -->
        <div class="admin-table-container">
          <div class="admin-table-header">
            <h3 class="admin-table-title">Phòng cụ thể</h3>
            <div class="admin-table-actions">
              <input type="text" class="search-input" id="search-rooms" placeholder="Tìm kiếm phòng..." />
              <button class="btn btn-primary" onclick="AdminRooms.showAddRoomModal()">
                <i class="fas fa-plus"></i>
                Thêm phòng
              </button>
            </div>
          </div>

          <div class="loading" id="rooms-loading">
            <div class="spinner"></div>
            <p>Đang tải dữ liệu...</p>
          </div>

          <table class="admin-table" id="rooms-table" style="display: none">
            <thead>
              <tr>
                <th>ID</th>
                <th>Số phòng</th>
                <th>Loại phòng</th>
                <th>Khách sạn</th>
                <th>Trạng thái</th>
                <th>Thao tác</th>
              </tr>
            </thead>
            <tbody id="rooms-table-body">
              <!-- Rooms will be loaded here -->
            </tbody>
          </table>
        </div>
      </main>
    </div>

    <!-- Add/Edit Room Type Modal -->
    <div class="modal admin-modal" id="room-type-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title" id="room-type-modal-title">Thêm loại phòng mới</h3>
          <button class="modal-close" onclick="Utils.hideModal('#room-type-modal')">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <form id="room-type-form" class="admin-form">
            <input type="hidden" id="room-type-id" name="id" />

            <div class="form-group">
              <label for="room-type-hotel" class="form-label">Khách sạn *</label>
              <select id="room-type-hotel" name="maKhachSan" class="form-input" required>
                <option value="">Chọn khách sạn</option>
              </select>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="room-type-name" class="form-label">Tên loại phòng *</label>
                <input type="text" id="room-type-name" name="tenLoaiPhong" class="form-input" required placeholder="VD: Deluxe, Standard..." />
              </div>
              <div class="form-group">
                <label for="room-type-capacity" class="form-label">Sức chứa *</label>
                <input type="number" id="room-type-capacity" name="sucChua" class="form-input" min="1" max="10" required />
              </div>
            </div>

            <div class="form-group">
              <label for="room-type-price" class="form-label">Giá một đêm (VNĐ) *</label>
              <input type="number" id="room-type-price" name="giaMotDem" class="form-input" min="0" step="1000" required />
            </div>

            <div class="form-group">
              <label for="room-type-description" class="form-label">Mô tả</label>
              <textarea id="room-type-description" name="moTa" class="form-input" rows="4" placeholder="Mô tả về loại phòng..."></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="Utils.hideModal('#room-type-modal')">Hủy</button>
          <button type="submit" form="room-type-form" class="btn btn-primary" id="room-type-save-btn">
            <i class="fas fa-save"></i>
            Lưu
          </button>
        </div>
      </div>
    </div>

    <!-- Add/Edit Room Modal -->
    <div class="modal admin-modal" id="room-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title" id="room-modal-title">Thêm phòng mới</h3>
          <button class="modal-close" onclick="Utils.hideModal('#room-modal')">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <form id="room-form" class="admin-form">
            <input type="hidden" id="room-id" name="id" />

            <div class="form-group">
              <label for="room-type-select" class="form-label">Loại phòng *</label>
              <select id="room-type-select" name="maLoaiPhong" class="form-input" required>
                <option value="">Chọn loại phòng</option>
              </select>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="room-number" class="form-label">Số phòng *</label>
                <input type="text" id="room-number" name="soPhong" class="form-input" required placeholder="VD: 101, 201A..." />
              </div>
              <div class="form-group">
                <label for="room-status" class="form-label">Trạng thái *</label>
                <select id="room-status" name="trangThai" class="form-input" required>
                  <option value="Available">Có sẵn</option>
                  <option value="Occupied">Đã đặt</option>
                  <option value="Maintenance">Bảo trì</option>
                </select>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="Utils.hideModal('#room-modal')">Hủy</button>
          <button type="submit" form="room-form" class="btn btn-primary" id="room-save-btn">
            <i class="fas fa-save"></i>
            Lưu
          </button>
        </div>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal" id="delete-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Xác nhận xóa</h3>
          <button class="modal-close" onclick="Utils.hideModal('#delete-modal')">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <p id="delete-message">Bạn có chắc chắn muốn xóa?</p>
          <p class="text-error">Hành động này không thể hoàn tác!</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="Utils.hideModal('#delete-modal')">Hủy</button>
          <button type="button" class="btn btn-error" id="confirm-delete-btn">
            <i class="fas fa-trash"></i>
            Xóa
          </button>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="../assets/js/utils.js"></script>
    <script src="../assets/js/auth.js"></script>
    <script src="../assets/js/hotel.js"></script>
    <script src="../assets/js/booking.js"></script>
    <script src="../assets/js/admin.js"></script>
    <script src="../assets/js/app.js"></script>

    <script>
      // Initialize Admin Rooms
      class AdminRooms {
        constructor() {
          this.hotels = [];
          this.roomTypes = [];
          this.rooms = [];
          this.selectedId = null;
          this.selectedType = null; // 'roomType' or 'room'

          this.init();
        }

        async init() {
          await this.loadInitialData();
          this.bindEvents();
        }

        async loadInitialData() {
          try {
            // Load hotels for filters and dropdowns
            this.hotels = await HotelService.getAllHotels();
            this.populateHotelFilters();

            // Load room types and rooms
            await this.loadRoomTypes();
            await this.loadRooms();
          } catch (error) {
            Utils.handleApiError(error);
          }
        }

        populateHotelFilters() {
          const hotelFilter = Utils.$("#hotel-filter");
          const roomTypeHotelSelect = Utils.$("#room-type-hotel");

          if (hotelFilter) {
            hotelFilter.innerHTML =
              '<option value="">Tất cả khách sạn</option>' +
              this.hotels.map((hotel) => `<option value="${hotel.maKhachSan}">${hotel.tenKhachSan}</option>`).join("");
          }

          if (roomTypeHotelSelect) {
            roomTypeHotelSelect.innerHTML =
              '<option value="">Chọn khách sạn</option>' +
              this.hotels.map((hotel) => `<option value="${hotel.maKhachSan}">${hotel.tenKhachSan}</option>`).join("");
          }
        }

        async loadRoomTypes() {
          try {
            Utils.show("#room-types-loading");
            Utils.hide("#room-types-table");

            // Mock data - replace with actual API call
            this.roomTypes = [
              {
                maLoaiPhong: 1,
                tenLoaiPhong: "Standard Room",
                tenKhachSan: "Hotel ABC",
                giaMotDem: 500000,
                sucChua: 2,
                soPhong: 10,
              },
              {
                maLoaiPhong: 2,
                tenLoaiPhong: "Deluxe Room",
                tenKhachSan: "Hotel ABC",
                giaMotDem: 800000,
                sucChua: 3,
                soPhong: 8,
              },
            ];

            this.renderRoomTypesTable();
            this.populateRoomTypeSelect();
          } catch (error) {
            Utils.handleApiError(error);
          } finally {
            Utils.hide("#room-types-loading");
            Utils.show("#room-types-table");
          }
        }

        async loadRooms() {
          try {
            Utils.show("#rooms-loading");
            Utils.hide("#rooms-table");

            // Mock data - replace with actual API call
            this.rooms = [
              {
                maPhong: 1,
                soPhong: "101",
                tenLoaiPhong: "Standard Room",
                tenKhachSan: "Hotel ABC",
                trangThai: "Available",
              },
              {
                maPhong: 2,
                soPhong: "102",
                tenLoaiPhong: "Standard Room",
                tenKhachSan: "Hotel ABC",
                trangThai: "Occupied",
              },
              {
                maPhong: 3,
                soPhong: "201",
                tenLoaiPhong: "Deluxe Room",
                tenKhachSan: "Hotel ABC",
                trangThai: "Available",
              },
            ];

            this.renderRoomsTable();
          } catch (error) {
            Utils.handleApiError(error);
          } finally {
            Utils.hide("#rooms-loading");
            Utils.show("#rooms-table");
          }
        }

        renderRoomTypesTable() {
          const tbody = Utils.$("#room-types-table-body");
          if (!tbody) return;

          if (this.roomTypes.length === 0) {
            tbody.innerHTML = `
                        <tr>
                            <td colspan="7" class="text-center">
                                Chưa có loại phòng nào
                            </td>
                        </tr>
                    `;
            return;
          }

          tbody.innerHTML = this.roomTypes
            .map(
              (roomType) => `
                    <tr>
                        <td>#${roomType.maLoaiPhong}</td>
                        <td>${roomType.tenLoaiPhong}</td>
                        <td>${roomType.tenKhachSan}</td>
                        <td>${Utils.formatCurrency(roomType.giaMotDem)}</td>
                        <td>${roomType.sucChua} khách</td>
                        <td>${roomType.soPhong} phòng</td>
                        <td class="actions">
                            <button class="btn btn-sm btn-outline" onclick="AdminRooms.editRoomType(${roomType.maLoaiPhong})" title="Sửa">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-error" onclick="AdminRooms.deleteRoomType(${roomType.maLoaiPhong})" title="Xóa">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `
            )
            .join("");
        }

        renderRoomsTable() {
          const tbody = Utils.$("#rooms-table-body");
          if (!tbody) return;

          if (this.rooms.length === 0) {
            tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center">
                                Chưa có phòng nào
                            </td>
                        </tr>
                    `;
            return;
          }

          tbody.innerHTML = this.rooms
            .map(
              (room) => `
                    <tr>
                        <td>#${room.maPhong}</td>
                        <td>${room.soPhong}</td>
                        <td>${room.tenLoaiPhong}</td>
                        <td>${room.tenKhachSan}</td>
                        <td>
                            <span class="status-badge ${room.trangThai.toLowerCase()}">
                                ${this.getStatusText(room.trangThai)}
                            </span>
                        </td>
                        <td class="actions">
                            <button class="btn btn-sm btn-outline" onclick="AdminRooms.editRoom(${room.maPhong})" title="Sửa">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-error" onclick="AdminRooms.deleteRoom(${room.maPhong})" title="Xóa">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `
            )
            .join("");
        }

        populateRoomTypeSelect() {
          const roomTypeSelect = Utils.$("#room-type-select");
          if (roomTypeSelect) {
            roomTypeSelect.innerHTML =
              '<option value="">Chọn loại phòng</option>' +
              this.roomTypes
                .map((roomType) => `<option value="${roomType.maLoaiPhong}">${roomType.tenLoaiPhong} - ${roomType.tenKhachSan}</option>`)
                .join("");
          }
        }

        getStatusText(status) {
          const statusMap = {
            Available: "Có sẵn",
            Occupied: "Đã đặt",
            Maintenance: "Bảo trì",
          };
          return statusMap[status] || status;
        }

        bindEvents() {
          // Hotel filter change
          const hotelFilter = Utils.$("#hotel-filter");
          if (hotelFilter) {
            hotelFilter.addEventListener("change", () => {
              this.filterByHotel();
            });
          }

          // Search functionality
          const searchRoomTypes = Utils.$("#search-room-types");
          const searchRooms = Utils.$("#search-rooms");

          if (searchRoomTypes) {
            searchRoomTypes.addEventListener(
              "input",
              Utils.debounce((e) => {
                this.searchRoomTypes(e.target.value);
              }, 300)
            );
          }

          if (searchRooms) {
            searchRooms.addEventListener(
              "input",
              Utils.debounce((e) => {
                this.searchRooms(e.target.value);
              }, 300)
            );
          }

          // Form submissions
          const roomTypeForm = Utils.$("#room-type-form");
          const roomForm = Utils.$("#room-form");

          if (roomTypeForm) {
            roomTypeForm.addEventListener("submit", (e) => {
              e.preventDefault();
              this.saveRoomType();
            });
          }

          if (roomForm) {
            roomForm.addEventListener("submit", (e) => {
              e.preventDefault();
              this.saveRoom();
            });
          }
        }

        filterByHotel() {
          const selectedHotelId = Utils.$("#hotel-filter").value;
          // Implementation for filtering by hotel
          Utils.showInfo("Chức năng lọc theo khách sạn đang được phát triển");
        }

        searchRoomTypes(searchTerm) {
          if (!searchTerm.trim()) {
            this.renderRoomTypesTable();
            return;
          }

          const filteredRoomTypes = this.roomTypes.filter(
            (roomType) =>
              roomType.tenLoaiPhong.toLowerCase().includes(searchTerm.toLowerCase()) ||
              roomType.tenKhachSan.toLowerCase().includes(searchTerm.toLowerCase())
          );

          const tbody = Utils.$("#room-types-table-body");
          if (filteredRoomTypes.length === 0) {
            tbody.innerHTML = `
                        <tr>
                            <td colspan="7" class="text-center">
                                Không tìm thấy loại phòng nào phù hợp
                            </td>
                        </tr>
                    `;
          } else {
            tbody.innerHTML = filteredRoomTypes
              .map(
                (roomType) => `
                        <tr>
                            <td>#${roomType.maLoaiPhong}</td>
                            <td>${roomType.tenLoaiPhong}</td>
                            <td>${roomType.tenKhachSan}</td>
                            <td>${Utils.formatCurrency(roomType.giaMotDem)}</td>
                            <td>${roomType.sucChua} khách</td>
                            <td>${roomType.soPhong} phòng</td>
                            <td class="actions">
                                <button class="btn btn-sm btn-outline" onclick="AdminRooms.editRoomType(${roomType.maLoaiPhong})" title="Sửa">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-error" onclick="AdminRooms.deleteRoomType(${roomType.maLoaiPhong})" title="Xóa">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `
              )
              .join("");
          }
        }

        searchRooms(searchTerm) {
          if (!searchTerm.trim()) {
            this.renderRoomsTable();
            return;
          }

          const filteredRooms = this.rooms.filter(
            (room) =>
              room.soPhong.toLowerCase().includes(searchTerm.toLowerCase()) ||
              room.tenLoaiPhong.toLowerCase().includes(searchTerm.toLowerCase()) ||
              room.tenKhachSan.toLowerCase().includes(searchTerm.toLowerCase())
          );

          const tbody = Utils.$("#rooms-table-body");
          if (filteredRooms.length === 0) {
            tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center">
                                Không tìm thấy phòng nào phù hợp
                            </td>
                        </tr>
                    `;
          } else {
            tbody.innerHTML = filteredRooms
              .map(
                (room) => `
                        <tr>
                            <td>#${room.maPhong}</td>
                            <td>${room.soPhong}</td>
                            <td>${room.tenLoaiPhong}</td>
                            <td>${room.tenKhachSan}</td>
                            <td>
                                <span class="status-badge ${room.trangThai.toLowerCase()}">
                                    ${this.getStatusText(room.trangThai)}
                                </span>
                            </td>
                            <td class="actions">
                                <button class="btn btn-sm btn-outline" onclick="AdminRooms.editRoom(${room.maPhong})" title="Sửa">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-error" onclick="AdminRooms.deleteRoom(${room.maPhong})" title="Xóa">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `
              )
              .join("");
          }
        }

        // Room Type Methods
        static showAddRoomTypeModal() {
          Utils.$("#room-type-modal-title").textContent = "Thêm loại phòng mới";
          Utils.$("#room-type-save-btn").innerHTML = '<i class="fas fa-save"></i> Lưu';
          Utils.clearForm("#room-type-form");
          Utils.showModal("#room-type-modal");
        }

        static editRoomType(roomTypeId) {
          const roomType = window.adminRooms.roomTypes.find((rt) => rt.maLoaiPhong === roomTypeId);
          if (!roomType) {
            Utils.showError("Không tìm thấy thông tin loại phòng");
            return;
          }

          Utils.$("#room-type-modal-title").textContent = "Sửa thông tin loại phòng";
          Utils.$("#room-type-save-btn").innerHTML = '<i class="fas fa-save"></i> Cập nhật';

          // Fill form data
          Utils.$("#room-type-id").value = roomType.maLoaiPhong;
          Utils.$("#room-type-name").value = roomType.tenLoaiPhong;
          Utils.$("#room-type-capacity").value = roomType.sucChua;
          Utils.$("#room-type-price").value = roomType.giaMotDem;
          Utils.$("#room-type-description").value = roomType.moTa || "";

          Utils.showModal("#room-type-modal");
        }

        static deleteRoomType(roomTypeId) {
          window.adminRooms.selectedId = roomTypeId;
          window.adminRooms.selectedType = "roomType";
          Utils.$("#delete-message").textContent = "Bạn có chắc chắn muốn xóa loại phòng này?";
          Utils.showModal("#delete-modal");

          const confirmBtn = Utils.$("#confirm-delete-btn");
          confirmBtn.onclick = async () => {
            try {
              // API call to delete room type
              Utils.showSuccess("Xóa loại phòng thành công");
              Utils.hideModal("#delete-modal");
              await window.adminRooms.loadRoomTypes();
            } catch (error) {
              Utils.handleApiError(error);
            }
          };
        }

        async saveRoomType() {
          const formData = Utils.getFormData("#room-type-form");
          const roomTypeId = formData.id;

          // Validate form
          if (!formData.maKhachSan) {
            Utils.showError("Vui lòng chọn khách sạn");
            return;
          }

          if (!formData.tenLoaiPhong.trim()) {
            Utils.showError("Vui lòng nhập tên loại phòng");
            return;
          }

          const saveBtn = Utils.$("#room-type-save-btn");
          saveBtn.disabled = true;
          saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Đang lưu...';

          try {
            // Mock save - replace with actual API call
            await new Promise((resolve) => setTimeout(resolve, 1000));

            Utils.showSuccess(roomTypeId ? "Cập nhật loại phòng thành công" : "Thêm loại phòng thành công");
            Utils.hideModal("#room-type-modal");
            await this.loadRoomTypes();
          } catch (error) {
            Utils.handleApiError(error);
          } finally {
            saveBtn.disabled = false;
            saveBtn.innerHTML = roomTypeId ? '<i class="fas fa-save"></i> Cập nhật' : '<i class="fas fa-save"></i> Lưu';
          }
        }

        // Room Methods
        static showAddRoomModal() {
          Utils.$("#room-modal-title").textContent = "Thêm phòng mới";
          Utils.$("#room-save-btn").innerHTML = '<i class="fas fa-save"></i> Lưu';
          Utils.clearForm("#room-form");
          Utils.showModal("#room-modal");
        }

        static editRoom(roomId) {
          const room = window.adminRooms.rooms.find((r) => r.maPhong === roomId);
          if (!room) {
            Utils.showError("Không tìm thấy thông tin phòng");
            return;
          }

          Utils.$("#room-modal-title").textContent = "Sửa thông tin phòng";
          Utils.$("#room-save-btn").innerHTML = '<i class="fas fa-save"></i> Cập nhật';

          // Fill form data
          Utils.$("#room-id").value = room.maPhong;
          Utils.$("#room-number").value = room.soPhong;
          Utils.$("#room-status").value = room.trangThai;

          Utils.showModal("#room-modal");
        }

        static deleteRoom(roomId) {
          window.adminRooms.selectedId = roomId;
          window.adminRooms.selectedType = "room";
          Utils.$("#delete-message").textContent = "Bạn có chắc chắn muốn xóa phòng này?";
          Utils.showModal("#delete-modal");

          const confirmBtn = Utils.$("#confirm-delete-btn");
          confirmBtn.onclick = async () => {
            try {
              // API call to delete room
              Utils.showSuccess("Xóa phòng thành công");
              Utils.hideModal("#delete-modal");
              await window.adminRooms.loadRooms();
            } catch (error) {
              Utils.handleApiError(error);
            }
          };
        }

        async saveRoom() {
          const formData = Utils.getFormData("#room-form");
          const roomId = formData.id;

          // Validate form
          if (!formData.maLoaiPhong) {
            Utils.showError("Vui lòng chọn loại phòng");
            return;
          }

          if (!formData.soPhong.trim()) {
            Utils.showError("Vui lòng nhập số phòng");
            return;
          }

          const saveBtn = Utils.$("#room-save-btn");
          saveBtn.disabled = true;
          saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Đang lưu...';

          try {
            // Mock save - replace with actual API call
            await new Promise((resolve) => setTimeout(resolve, 1000));

            Utils.showSuccess(roomId ? "Cập nhật phòng thành công" : "Thêm phòng thành công");
            Utils.hideModal("#room-modal");
            await this.loadRooms();
          } catch (error) {
            Utils.handleApiError(error);
          } finally {
            saveBtn.disabled = false;
            saveBtn.innerHTML = roomId ? '<i class="fas fa-save"></i> Cập nhật' : '<i class="fas fa-save"></i> Lưu';
          }
        }
      }

      // Initialize when page loads
      document.addEventListener("DOMContentLoaded", () => {
        if (Utils.requireAdmin()) {
          window.adminRooms = new AdminRooms();
        }
      });
    </script>
  </body>
</html>
